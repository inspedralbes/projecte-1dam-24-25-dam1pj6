<%- include('partials/header', { title: 'Projecte incidències' }) %>

<h1>Benvingut al projecte Incidències!</h1>
<p>Aquesta és la pàgina d’inici, renderitzada amb EJS.</p>

<h3>Estat d'una incidència</h3>
<form action="/incidencies/buscar" method="post">
  <input type="text" name="id" placeholder="Cerca per ID" required>
  <button type="submit">Cerca</button>
</form>

<% if (incidencia) { %>
  <h2>Resultat de la cerca</h2>
  <p><strong>ID:</strong> <%= incidencia.id %></p>
  <p><strong>Departament:</strong> <%= incidencia.departament ? incidencia.departament.nom : 'Desconegut' %></p>
  <p><strong>Descripció:</strong> <%= incidencia.descripcio %></p>
  <p><strong>Estat:</strong> <%= incidencia.estat ? incidencia.estat.nom : 'Desconegut' %></p>
  <p><strong>Actuacions visibles per l’usuari:</strong></p>
  <ul>
    <% 
      const visibles = incidencia.actuacions?.filter(a => a.visible_per_usuari);
      if (visibles && visibles.length > 0) { 
        visibles.forEach(actuacio => { 
    %>
      <li><%= actuacio.descripcio %></li>
    <% 
        }) 
      } else { 
    %>
      <li>Cap actuació visible</li>
    <% } %>
  </ul>

<% } else if (error) { %>
  <p><%= error %></p>
<% } %>

<%- include('partials/footer') %>
